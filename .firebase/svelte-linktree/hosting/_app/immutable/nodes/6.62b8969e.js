import{s as le,v as G,p as H,e as J,g as C,c as U,h as w,i as B,d as j,A as D,k as T,C as K,D as ae,E as oe,l as P,m as R,z as W}from"../chunks/scheduler.d978c4dc.js";import{S as ue,i as ce,d as S,v as fe,j as re,k as me,m as de,b as he,t as _e,l as pe,a as y,e as b,g as k,n as g,p as O,s as N}from"../chunks/index.7cd3bf66.js";import{A as $}from"../chunks/AuthCheck.88256d3c.js";import{d as V,u as z,a as L,g as I,j as Q,W as X}from"../chunks/firebase.312fba77.js";const A="src/routes/login/username/+page.svelte";function ee(i){let e,t,o,n,a,s,l,c,E,r=i[1]&&q(i),m=!i[3]&&i[5]&&Y(i),d=i[3]&&!i[2]&&!i[1]&&F(i),h=i[2]&&M(i);const v={c:function(){e=C("form"),t=C("input"),o=U(),n=C("div"),r&&r.c(),a=U(),m&&m.c(),s=U(),d&&d.c(),l=U(),h&&h.c(),this.h()},l:function(u){e=w(u,"FORM",{class:!0});var p=B(e);t=w(p,"INPUT",{type:!0,placeholder:!0,class:!0}),o=j(p),n=w(p,"DIV",{class:!0});var f=B(n);r&&r.l(f),a=j(f),m&&m.l(f),s=j(f),d&&d.l(f),l=j(f),h&&h.l(f),f.forEach(b),p.forEach(b),this.h()},h:function(){k(t,"type","text"),k(t,"placeholder","Username"),k(t,"class","input w-full"),D(t,"input-error",!i[3]&&i[5]),D(t,"input-warning",i[4]),D(t,"input-success",i[2]&&i[3]&&!i[1]),T(t,A,70,6,1738),k(n,"class","my-4 min-h-16 px-8 w-full"),T(n,A,81,6,2071),k(e,"class","w-2/5"),T(e,A,69,4,1667)},m:function(u,p){y(u,e,p),g(e,t),K(t,i[0]),g(e,o),g(e,n),r&&r.m(n,null),g(n,a),m&&m.m(n,null),g(n,s),d&&d.m(n,null),g(n,l),h&&h.m(n,null),c||(E=[O(t,"input",i[9]),O(t,"input",i[7],!1,!1,!1,!1),O(e,"submit",ae(i[8]),!1,!0,!1,!1)],c=!0)},p:function(u,p){p&1&&t.value!==u[0]&&K(t,u[0]),p&40&&D(t,"input-error",!u[3]&&u[5]),p&16&&D(t,"input-warning",u[4]),p&14&&D(t,"input-success",u[2]&&u[3]&&!u[1]),u[1]?r?r.p(u,p):(r=q(u),r.c(),r.m(n,a)):r&&(r.d(1),r=null),!u[3]&&u[5]?m||(m=Y(u),m.c(),m.m(n,s)):m&&(m.d(1),m=null),u[3]&&!u[2]&&!u[1]?d?d.p(u,p):(d=F(u),d.c(),d.m(n,l)):d&&(d.d(1),d=null),u[2]?h?h.p(u,p):(h=M(u),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d:function(u){u&&b(e),r&&r.d(),m&&m.d(),d&&d.d(),h&&h.d(),c=!1,oe(E)}};return S("SvelteRegisterBlock",{block:v,id:ee.name,type:"else",source:"(57:2) {:else}",ctx:i}),v}function te(i){let e,t,o,n,a=i[6].username+"",s,l,c,E="(Usernames cannot be changed)",r,m,d="Upload Profile Image";const h={c:function(){e=C("p"),t=P("Your username is "),o=C("span"),n=P("@"),s=P(a),l=U(),c=C("p"),c.textContent=E,r=U(),m=C("a"),m.textContent=d,this.h()},l:function(_){e=w(_,"P",{class:!0});var u=B(e);t=R(u,"Your username is "),o=w(u,"SPAN",{class:!0});var p=B(o);n=R(p,"@"),s=R(p,a),p.forEach(b),u.forEach(b),l=j(_),c=w(_,"P",{class:!0,["data-svelte-h"]:!0}),W(c)!=="svelte-dzoiqw"&&(c.textContent=E),r=j(_),m=w(_,"A",{class:!0,href:!0,["data-svelte-h"]:!0}),W(m)!=="svelte-vogdig"&&(m.textContent=d),this.h()},h:function(){k(o,"class","text-success font-bold"),T(o,A,62,23,1412),k(e,"class","text-lg"),T(e,A,61,4,1368),k(c,"class","text-sm mt-1 mb-2"),T(c,A,66,4,1511),k(m,"class","btn btn-primary"),k(m,"href","/login/photo"),T(m,A,67,4,1579)},m:function(_,u){y(_,e,u),g(e,t),g(e,o),g(o,n),g(o,s),y(_,l,u),y(_,c,u),y(_,r,u),y(_,m,u)},p:function(_,u){u&64&&a!==(a=_[6].username+"")&&N(s,a)},d:function(_){_&&(b(e),b(l),b(c),b(r),b(m))}};return S("SvelteRegisterBlock",{block:h,id:te.name,type:"if",source:"(49:2) {#if $userData?.username}",ctx:i}),h}function q(i){let e,t,o,n;const a={c:function(){e=C("p"),t=P("Checking availability of @"),o=P(i[0]),n=P("..."),this.h()},l:function(l){e=w(l,"P",{class:!0});var c=B(e);t=R(c,"Checking availability of @"),o=R(c,i[0]),n=R(c,"..."),c.forEach(b),this.h()},h:function(){k(e,"class","text-secondary"),T(e,A,83,10,2145)},m:function(l,c){y(l,e,c),g(e,t),g(e,o),g(e,n)},p:function(l,c){c&1&&N(o,l[0])},d:function(l){l&&b(e)}};return S("SvelteRegisterBlock",{block:a,id:q.name,type:"if",source:"(71:8) {#if loading}",ctx:i}),a}function Y(i){let e,t="must be 3-16 characters long, alphanumeric only";const o={c:function(){e=C("p"),e.textContent=t,this.h()},l:function(a){e=w(a,"P",{class:!0,["data-svelte-h"]:!0}),W(e)!=="svelte-1wurl8l"&&(e.textContent=t),this.h()},h:function(){k(e,"class","text-error text-sm"),T(e,A,87,10,2280)},m:function(a,s){y(a,e,s)},d:function(a){a&&b(e)}};return S("SvelteRegisterBlock",{block:o,id:Y.name,type:"if",source:"(75:8) {#if !isValid && isTouched}",ctx:i}),o}function F(i){let e,t,o,n;const a={c:function(){e=C("p"),t=P("@"),o=P(i[0]),n=P(" is not available"),this.h()},l:function(l){e=w(l,"P",{class:!0});var c=B(e);t=R(c,"@"),o=R(c,i[0]),n=R(c," is not available"),c.forEach(b),this.h()},h:function(){k(e,"class","text-warning text-sm"),T(e,A,93,10,2467)},m:function(l,c){y(l,e,c),g(e,t),g(e,o),g(e,n)},p:function(l,c){c&1&&N(o,l[0])},d:function(l){l&&b(e)}};return S("SvelteRegisterBlock",{block:a,id:F.name,type:"if",source:"(81:8) {#if isValid && !isAvailable && !loading}",ctx:i}),a}function M(i){let e,t,o;const n={c:function(){e=C("button"),t=P("Confirm username @"),o=P(i[0]),this.h()},l:function(s){e=w(s,"BUTTON",{class:!0});var l=B(e);t=R(l,"Confirm username @"),o=R(l,i[0]),l.forEach(b),this.h()},h:function(){k(e,"class","btn btn-success"),T(e,A,99,10,2613)},m:function(s,l){y(s,e,l),g(e,t),g(e,o)},p:function(s,l){l&1&&N(o,s[0])},d:function(s){s&&b(e)}};return S("SvelteRegisterBlock",{block:n,id:M.name,type:"if",source:"(87:8) {#if isAvailable}",ctx:i}),n}function ne(i){let e;function t(s,l){var c;return(c=s[6])!=null&&c.username?te:ee}let o=t(i),n=o(i);const a={c:function(){n.c(),e=J()},l:function(l){n.l(l),e=J()},m:function(l,c){n.m(l,c),y(l,e,c)},p:function(l,c){o===(o=t(l))&&n?n.p(l,c):(n.d(1),n=o(l),n&&(n.c(),n.m(e.parentNode,e)))},d:function(l){l&&b(e),n.d(l)}};return S("SvelteRegisterBlock",{block:a,id:ne.name,type:"slot",source:"(48:0) <AuthCheck>",ctx:i}),a}function Z(i){let e,t;e=new $({props:{$$slots:{default:[ne]},$$scope:{ctx:i}},$$inline:!0});const o={c:function(){re(e.$$.fragment)},l:function(a){me(e.$$.fragment,a)},m:function(a,s){de(e,a,s),t=!0},p:function(a,[s]){const l={};s&4223&&(l.$$scope={dirty:s,ctx:a}),e.$set(l)},i:function(a){t||(he(e.$$.fragment,a),t=!0)},o:function(a){_e(e.$$.fragment,a),t=!1},d:function(a){pe(e,a)}};return S("SvelteRegisterBlock",{block:o,id:Z.name,type:"component",source:"",ctx:i}),o}const x=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function be(i,e,t){let o,n,a,s,l;G(z,"user"),H(i,z,f=>t(11,s=f)),G(L,"userData"),H(i,L,f=>t(6,l=f));let{$$slots:c={},$$scope:E}=e;fe("Page",c,[]);let r="",m=!1,d=!1,h;async function v(){t(2,d=!1),clearTimeout(h),t(1,m=!0),h=setTimeout(async()=>{const f=I(V,"usernames",r),ie=await Q(f).then(se=>se.exists());t(2,d=!ie),t(1,m=!1)},500)}async function _(){const f=X(V);f.set(I(V,"usernames",r),{uid:s==null?void 0:s.uid}),f.set(I(V,"users",s.uid),{username:r,photoURL:(s==null?void 0:s.photoURL)??null,published:!0,bio:"I am the Walrus",links:[{title:"Test Link",url:"https://kung.foo",icon:"custom"}]}),await f.commit(),t(0,r=""),t(2,d=!1)}const u=[];Object.keys(e).forEach(f=>{!~u.indexOf(f)&&f.slice(0,2)!=="$$"&&f!=="slot"&&console.warn(`<Page> was created with unknown prop '${f}'`)});function p(){r=this.value,t(0,r)}return i.$capture_state=()=>({AuthCheck:$,db:V,user:z,userData:L,doc:I,getDoc:Q,writeBatch:X,username:r,loading:m,isAvailable:d,debounceTimer:h,re:x,checkIfAvailable:v,confirmUsername:_,isValid:o,isTaken:a,isTouched:n,$user:s,$userData:l}),i.$inject_state=f=>{"username"in f&&t(0,r=f.username),"loading"in f&&t(1,m=f.loading),"isAvailable"in f&&t(2,d=f.isAvailable),"debounceTimer"in f&&(h=f.debounceTimer),"isValid"in f&&t(3,o=f.isValid),"isTaken"in f&&t(4,a=f.isTaken),"isTouched"in f&&t(5,n=f.isTouched)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&1&&t(3,o=(r==null?void 0:r.length)>2&&r.length<16&&x.test(r)),i.$$.dirty&1&&t(5,n=r.length>0),i.$$.dirty&14&&t(4,a=o&&!d&&!m)},[r,m,d,o,a,n,l,v,_,p]}class Ce extends ue{constructor(e){super(e),ce(this,e,be,Z,le,{}),S("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Z.name})}}export{Ce as component};
